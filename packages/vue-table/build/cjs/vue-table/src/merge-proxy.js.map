{"version":3,"file":"merge-proxy.js","sources":["../../../../src/merge-proxy.ts"],"sourcesContent":["function trueFn() {\n  return true\n}\n\nexport const $PROXY = Symbol('merge-proxy')\n\n// https://github.com/solidjs/solid/blob/c20ca4fd8c36bc0522fedb2c7f38a110b7ee2663/packages/solid/src/render/component.ts#L51-L118\nconst propTraps: ProxyHandler<{\n  get: (k: string | number | symbol) => any\n  has: (k: string | number | symbol) => boolean\n  keys: () => string[]\n}> = {\n  get(_, property, receiver) {\n    if (property === $PROXY) return receiver\n    return _.get(property)\n  },\n  has(_, property) {\n    return _.has(property)\n  },\n  set: trueFn,\n  deleteProperty: trueFn,\n  getOwnPropertyDescriptor(_, property) {\n    return {\n      configurable: true,\n      enumerable: true,\n      get() {\n        return _.get(property)\n      },\n      set: trueFn,\n      deleteProperty: trueFn,\n    }\n  },\n  ownKeys(_) {\n    return _.keys()\n  },\n}\n\ntype UnboxLazy<T> = T extends () => infer U ? U : T\ntype BoxedTupleTypes<T extends any[]> = {\n  [P in keyof T]: [UnboxLazy<T[P]>]\n}[Exclude<keyof T, keyof any[]>]\ntype UnionToIntersection<U> = (U extends any ? (k: U) => void : never) extends (\n  k: infer I\n) => void\n  ? I\n  : never\ntype UnboxIntersection<T> = T extends { 0: infer U } ? U : never\ntype MergeProxy<T extends any[]> = UnboxIntersection<\n  UnionToIntersection<BoxedTupleTypes<T>>\n>\n\nfunction resolveSource(s: any) {\n  return 'value' in s ? s.value : s\n}\n\nexport function mergeProxy<T extends any[]>(...sources: T): MergeProxy<T>\nexport function mergeProxy(...sources: any): any {\n  return new Proxy(\n    {\n      get(property: string | number | symbol) {\n        for (let i = sources.length - 1; i >= 0; i--) {\n          const v = resolveSource(sources[i])[property]\n          if (v !== undefined) return v\n        }\n      },\n      has(property: string | number | symbol) {\n        for (let i = sources.length - 1; i >= 0; i--) {\n          if (property in resolveSource(sources[i])) return true\n        }\n        return false\n      },\n      keys() {\n        const keys = []\n        for (let i = 0; i < sources.length; i++)\n          keys.push(...Object.keys(resolveSource(sources[i])))\n        return [...new Set(keys)]\n      },\n    },\n    propTraps\n  )\n}\n"],"names":["trueFn","$PROXY","Symbol","propTraps","get","_","property","receiver","has","set","deleteProperty","getOwnPropertyDescriptor","configurable","enumerable","ownKeys","keys","resolveSource","s","value","mergeProxy","sources","Proxy","i","length","v","undefined","push","Object","Set"],"mappings":"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"}