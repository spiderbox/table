{"version":3,"file":"index.js","sources":["../../../../src/index.ts"],"sourcesContent":["import {\n  RowData,\n  createTable,\n  TableOptions,\n  TableOptionsResolved,\n} from '@tanstack/table-core'\nimport Placeholder from './placeholder'\nimport { SvelteComponent } from 'svelte/internal'\nimport { readable, writable, derived, Readable, get } from 'svelte/store'\nimport { renderComponent } from './render-component'\n\nexport { renderComponent } from './render-component'\n\nexport * from '@tanstack/table-core'\n\nfunction isSvelteServerComponent(component: any) {\n  return (\n    typeof component === 'object' &&\n    typeof component.$$render === 'function' &&\n    typeof component.render === 'function'\n  )\n}\n\nfunction isSvelteClientComponent(component: any) {\n  let isHMR = '__SVELTE_HMR' in window\n\n  return (\n    component.prototype instanceof SvelteComponent ||\n    (isHMR &&\n      component.name?.startsWith('Proxy<') &&\n      component.name?.endsWith('>'))\n  )\n}\n\nfunction isSvelteComponent(component: any) {\n  if (typeof document === 'undefined') {\n    return isSvelteServerComponent(component)\n  } else {\n    return isSvelteClientComponent(component)\n  }\n}\n\nfunction wrapInPlaceholder(content: any) {\n  return renderComponent(Placeholder, { content })\n}\n\nexport function flexRender(component: any, props: any) {\n  if (!component) return null\n\n  if (isSvelteComponent(component)) {\n    return renderComponent(component, props)\n  }\n\n  if (typeof component === 'function') {\n    const result = component(props)\n\n    if (isSvelteComponent(result)) {\n      return result\n    }\n\n    return wrapInPlaceholder(result)\n  }\n\n  return wrapInPlaceholder(component)\n}\n\ntype ReadableOrVal<T> = T | Readable<T>\n\nexport function createSvelteTable<TData extends RowData>(\n  options: ReadableOrVal<TableOptions<TData>>\n) {\n  let optionsStore: Readable<TableOptions<TData>>\n\n  if ('subscribe' in options) {\n    optionsStore = options\n  } else {\n    optionsStore = readable(options)\n  }\n\n  let resolvedOptions: TableOptionsResolved<TData> = {\n    state: {}, // Dummy state\n    onStateChange: () => {}, // noop\n    renderFallbackValue: null,\n    ...get(optionsStore),\n  }\n\n  let table = createTable(resolvedOptions)\n\n  let stateStore = writable(/** @type {number} */ table.initialState)\n  // combine stores\n  let stateOptionsStore = derived([stateStore, optionsStore], s => s)\n  const tableReadable = readable(table, function start(set) {\n    const unsubscribe = stateOptionsStore.subscribe(([state, options]) => {\n      table.setOptions(prev => {\n        return {\n          ...prev,\n          ...options,\n          state: { ...state, ...options.state },\n          // Similarly, we'll maintain both our internal state and any user-provided\n          // state.\n          onStateChange: updater => {\n            if (updater instanceof Function) {\n              stateStore.update(updater)\n            } else {\n              stateStore.set(updater)\n            }\n\n            resolvedOptions.onStateChange?.(updater)\n          },\n        }\n      })\n\n      // it didn't seem to rerender without setting the table\n      set(table)\n    })\n\n    return function stop() {\n      unsubscribe()\n    }\n  })\n\n  return tableReadable\n}\n"],"names":["isSvelteServerComponent","component","$$render","render","isSvelteClientComponent","isHMR","window","prototype","SvelteComponent","name","startsWith","endsWith","isSvelteComponent","document","wrapInPlaceholder","content","renderComponent","Placeholder","flexRender","props","result","createSvelteTable","options","optionsStore","readable","resolvedOptions","state","onStateChange","renderFallbackValue","get","table","createTable","stateStore","writable","initialState","stateOptionsStore","derived","s","tableReadable","start","set","unsubscribe","subscribe","setOptions","prev","updater","Function","update","stop"],"mappings":"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"}